<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>다각형에 이벤트 등록하기2</title>
    <style>
.area {
    position: absolute;
    background: #fff;
    border: 1px solid #888;
    border-radius: 3px;
    font-size: 12px;
    top: -5px;
    left: 15px;
    padding:2px;
}

.info {
    font-size: 12px;
    padding: 5px;
}
.info .title {
    font-weight: bold;
}
</style>
</head>
<body>
    
<div id="map" style="width:100%;height:80vh;"></div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7560b5ddb94a9dc91354ef62a6b750ee"></script>
<script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = { 
            center: new kakao.maps.LatLng(35.1798200522868, 129.075087492149), // 지도의 중심좌표
            level: 10 // 지도의 확대 레벨
        };
    
    var map = new kakao.maps.Map(mapContainer, mapOption),
        customOverlay = new kakao.maps.CustomOverlay({});
    
    const areas = [{
        name: '부산',
        path: [    ]
    }]; 
    
    
    // 다각형을 생상하고 이벤트를 등록하는 함수입니다
    function displayArea(area) {
    
    // 다각형을 생성합니다 
    var polygon = new kakao.maps.Polygon({
        map: map, 
        path: area.path.flat(),
        strokeWeight: 2,
        strokeColor: '#FF0000', // 빨간색으로 변경
        strokeOpacity: 1, // 불투명도 1로 변경
        fillColor: '#00FF00', // 초록색으로 변경
        fillOpacity: 0.5 
    });
    
    // 다각형에 mouseover 이벤트를 등록하고 이벤트가 발생하면 폴리곤의 채움색을 변경합니다 
    // 지역명을 표시하는 커스텀오버레이를 지도위에 표시합니다
    kakao.maps.event.addListener(polygon, 'mouseover', function(mouseEvent) {
        polygon.setOptions({fillColor: '#09f'});
    
        customOverlay.setContent('<div class="area">' + area.name + '</div>');
        
        customOverlay.setPosition(mouseEvent.latLng); 
        customOverlay.setMap(map);
    });
    
    // 다각형에 mousemove 이벤트를 등록하고 이벤트가 발생하면 커스텀 오버레이의 위치를 변경합니다 
    kakao.maps.event.addListener(polygon, 'mousemove', function(mouseEvent) {
        
        customOverlay.setPosition(mouseEvent.latLng); 
    });
    
    // 다각형에 mouseout 이벤트를 등록하고 이벤트가 발생하면 폴리곤의 채움색을 원래색으로 변경합니다
    // 커스텀 오버레이를 지도에서 제거합니다 
    kakao.maps.event.addListener(polygon, 'mouseout', function() {
        polygon.setOptions({fillColor: '#fff'});
        customOverlay.setMap(null);
    }); 
    }

    function roundTo(num, decimalPlaces) {
        let factor = Math.pow(10, decimalPlaces);
        return Math.round(num * factor) / factor;
    }
    
    /// JSON 파일 읽기
    fetch('korea_b2.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(jsonData => {
            const features = jsonData.features;
    
            const sido = features.find(feature => feature.properties.CTP_ENG_NM == "Busan");
            const coordinates = sido.geometry.coordinates;
    
            coordinates.forEach(innerArray => {
                innerArray.forEach(coord => {
                    coord.forEach(value => {
                        areas[0].path.push(new kakao.maps.LatLng(roundTo(value[0], 14), roundTo(value[1], 14)));
                    });
                });
            });
         
         // 지도에 영역데이터를 폴리곤으로 표시합니다 
            displayArea(areas[0]);
        
        })
        .catch(error => {
            console.error('Error fetching JSON:', error);
        });
    
    console.log(areas);
</script>

</body>
</html>